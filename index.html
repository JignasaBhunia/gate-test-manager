<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GATE Test Manager â€” Improved</title>
  <style>
    :root{--bg:#f6f9fb;--card:#fff;--muted:#6b7280;--brand:#0ea5a4}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial; margin:0; background:var(--bg); color:#0f172a}
    .wrap{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    h1{margin:0;font-size:20px}
    .grid{display:grid;gap:12px}
    .panel{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    form{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px}
    input,select,textarea,button{padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px}
    button{background:var(--brand);color:#fff;border:none}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:8px;border-bottom:1px solid #f1f5f9;text-align:left}
    thead th{background:#f8fafc;font-weight:600;color:var(--muted)}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .small{font-size:12px;color:var(--muted)}
    @media(max-width:720px){thead{display:none}table,tbody,td,tr{display:block;width:100%}td{padding:10px;border-bottom:1px solid #eee}td:before{content:attr(data-label);display:block;font-weight:600;margin-bottom:6px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ðŸŽ¯ GATE Test Manager â€” Improved</h1>
      <div class="small">IDs: ME###, ZE###, GO### â€” dates left blank for you to fill when you take tests</div>
    </header>

    <div class="grid" style="grid-template-columns:1fr 320px;gap:16px;margin-top:16px">
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div><strong>Add / Edit Test</strong><div class="small">Add a test or edit selected row</div></div>
          <div class="small">Storage: localStorage (persisted)</div>
        </div>

        <form id="testForm">
          <input type="hidden" id="uid">
          <div><label class="small">Test Name</label><input id="name" required></div>
          <div><label class="small">Date (leave blank)</label><input id="date" type="date"></div>
          <div><label class="small">Subject</label>
            <select id="subject">
              <option value="Discrete Mathematics">Discrete Mathematics</option>
              <option value="Engineering Mathematics">Engineering Mathematics</option>
              <option value="Digital Logic">Digital Logic</option>
              <option value="DBMS">DBMS</option>
              <option value="C Programming">C Programming</option>
              <option value="TOC">TOC</option>
              <option value="Computer Networks">Computer Networks</option>
              <option value="Compiler Design">Compiler Design</option>
              <option value="COA">COA</option>
              <option value="Operating Systems">Operating Systems</option>
              <option value="Data Structures">Data Structures</option>
              <option value="Algorithms">Algorithms</option>
              <option value="Aptitude">Aptitude</option>
              <option value="Full Syllabus">Full Syllabus</option>
              <option value="Combined">Combined</option>
            </select>
          </div>

          <div>
            <label class="small">Platform</label>
            <select id="platform">
              <option>GO Classes</option>
              <option>Made Easy</option>
              <option>Gate At Zeal</option>
            </select>
          </div>

          <div><label class="small">Test Type</label>
            <select id="type">
              <option value="Topic">Topic</option>
              <option value="Subject">Subject</option>
              <option value="Full">Full</option>
              <option value="Mock">Mock</option>
              <option value="Combined">Combined</option>
            </select>
          </div>

          <div><label class="small">Number of Questions</label><input id="questions" type="number"></div>
          <div><label class="small">Total Marks</label><input id="marks" type="number"></div>
          <div><label class="small">Time (min)</label><input id="time" type="number"></div>
          <div><label class="small">Marks Obtained</label><input id="obtained" type="number"></div>
          <div style="grid-column:1/-1"><label class="small">Remarks</label><textarea id="remarks" rows="2"></textarea></div>

          <div style="grid-column:1/-1;display:flex;gap:8px">
            <button id="saveBtn">Save</button>
            <button type="button" id="pickRandom">Pick Random Pending</button>
            <button type="button" id="exportCsv">Export CSV</button>
            <button type="button" id="importCsv">Import CSV</button>
            <button type="button" id="resetData">Reset</button>
          </div>
        </form>
      </div>

      <div class="panel">
        <strong>Dashboard</strong>
        <div class="small">Quick analytics and filters</div>
        <div style="margin-top:12px">
          <div class="small">Platform</div>
          <select id="filterPlatform"><option value="">All</option><option>GO Classes</option><option>Made Easy</option><option>Gate At Zeal</option></select>
          <div class="small" style="margin-top:8px">Subject</div>
          <select id="filterSubject"><option value="">All</option></select>
          <div style="margin-top:8px" class="small">Status</div>
          <select id="filterStatus"><option value="">All</option><option value="Not Started">Not Started</option><option value="Completed">Completed</option></select>
        </div>
        <div style="margin-top:12px">
          <div class="small">Totals</div>
          <div style="display:flex;gap:8px;margin-top:6px">
            <div><div class="small">Total</div><div id="statTotal">0</div></div>
            <div><div class="small">Pending</div><div id="statPending">0</div></div>
            <div><div class="small">Completed</div><div id="statCompleted">0</div></div>
            <div><div class="small">Avg Score</div><div id="statAvg">â€”</div></div>
          </div>
        </div>
      </div>
    </div>

    <div class="panel" style="margin-top:14px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Test List</strong>
        <div class="controls small"><input id="search" placeholder="search name/subject" style="padding:8px;border-radius:8px;border:1px solid #eee"></div>
      </div>

      <div style="overflow:auto;max-height:420px">
        <table id="testsTable">
          <thead>
            <tr><th>ID</th><th>Platform</th><th>Name</th><th>Date</th><th>Subject</th><th>Type</th><th>Q</th><th>Marks</th><th>Time</th><th>Score</th><th>Status</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="panel small" style="margin-top:12px">
      <strong>Resources (uploaded schedules)</strong>
      <ul>
        <li>/mnt/data/2758imguf_CS-2026-Schedule.pdf</li>
        <li>/mnt/data/GateAtZeal 2026 Schedule.pdf</li>
        <li>/mnt/data/GO Schedule 2026.pdf</li>
        <li>/mnt/data/index.html</li>
      </ul>
      <div class="small" style="margin-top:8px">These are the raw PDFs you uploaded â€” dates in the app are left blank because activation dates â‰  when you take the test. Fill date when you actually attempt.</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script>
    // Utility: create unique IDs for seeds
    function pad(n){return n.toString().padStart(3,'0')}
    function uid(prefix,i){return prefix+pad(i)}

    // Generate seed data (placeholders) for counts requested
    const seeds = [];
    // Made Easy: 48 tests (prefix ME)
    for(let i=1;i<=48;i++){
      seeds.push({id:uid('ME',i),platform:'Made Easy',name:`Made Easy Test ${i}`,date:'',subject:'',type:'Topic',questions:17,marks:25,time:45,obtained:'',remarks:'',status:'Not Started'});
    }
    // Gate At Zeal: 80 tests (prefix ZE)
    for(let i=1;i<=80;i++){
      seeds.push({id:uid('ZE',i),platform:'Gate At Zeal',name:`Zeal Test ${i}`,date:'',subject:'',type:'Topic',questions:17,marks:25,time:45,obtained:'',remarks:'',status:'Not Started'});
    }
    // GO Classes: 108 tests (prefix GO)
    for(let i=1;i<=108;i++){
      seeds.push({id:uid('GO',i),platform:'GO Classes',name:`GO Test ${i}`,date:'',subject:'',type:'Topic',questions:17,marks:25,time:60,obtained:'',remarks:'',status:'Not Started'});
    }

    // Save & load from localStorage
    const STORAGE_KEY = 'gate_tests_v2';
    function load(){
      const raw=localStorage.getItem(STORAGE_KEY);
      if(raw){try{return JSON.parse(raw)}catch(e){console.warn('bad storage',e);}}
      // if no data, populate seeds and persist
      localStorage.setItem(STORAGE_KEY,JSON.stringify(seeds));
      return JSON.parse(JSON.stringify(seeds));
    }

    let tests = load();

    // populate subject filter list
    function populateSubjects(){
      const ss = new Set(tests.map(t=>t.subject).filter(Boolean));
      const sel = document.getElementById('filterSubject');
      sel.innerHTML = '<option value="">All</option>' + [...ss].map(s=>`<option>${s}</option>`).join('');
    }

    // render table
    function renderTable(filter){
      filter = filter||{};
      const tbody = document.querySelector('#testsTable tbody'); tbody.innerHTML='';
      const q = document.getElementById('search').value.toLowerCase();
      const rows = tests.filter(t=>{
        if(filter.platform && t.platform!==filter.platform) return false;
        if(filter.subject && t.subject!==filter.subject) return false;
        if(filter.status && t.status!==filter.status) return false;
        if(q && !(t.name.toLowerCase().includes(q)|| (t.subject||'').toLowerCase().includes(q))) return false;
        return true;
      });
      rows.forEach(t=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${t.id}</td><td>${t.platform}</td><td>${t.name}</td><td>${t.date||''}</td><td>${t.subject||''}</td><td>${t.type}</td><td>${t.questions}</td><td>${t.marks}</td><td>${t.time}</td><td>${t.obtained||''}</td><td>${t.status||'Not Started'}</td>`;
        tr.onclick = ()=>loadIntoForm(t.id);
        tbody.appendChild(tr);
      });
      document.getElementById('statTotal').innerText = tests.length;
      document.getElementById('statPending').innerText = tests.filter(x=>!x.obtained).length;
      document.getElementById('statCompleted').innerText = tests.filter(x=>x.obtained).length;
      const avg = tests.filter(x=>x.obtained).map(x=>Number(x.obtained)).filter(n=>!isNaN(n));
      document.getElementById('statAvg').innerText = avg.length? (Math.round((avg.reduce((a,b)=>a+b,0)/avg.length)*100)/100) : 'â€”';
      populateSubjects();
    }

    function persist(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(tests)); }

    function loadIntoForm(id){
      const t = tests.find(x=>x.id===id); if(!t) return;
      document.getElementById('uid').value = t.id;
      document.getElementById('name').value = t.name;
      document.getElementById('date').value = t.date||'';
      document.getElementById('subject').value = t.subject||'';
      document.getElementById('platform').value = t.platform;
      document.getElementById('type').value = t.type;
      document.getElementById('questions').value = t.questions||'';
      document.getElementById('marks').value = t.marks||'';
      document.getElementById('time').value = t.time||'';
      document.getElementById('obtained').value = t.obtained||'';
      document.getElementById('remarks').value = t.remarks||'';
      window.scrollTo({top:0,behavior:'smooth'});
    }

    document.getElementById('testForm').onsubmit = function(e){
      e.preventDefault();
      const id = document.getElementById('uid').value || generateNewId(document.getElementById('platform').value);
      const entry = {
        id:id,
        platform:document.getElementById('platform').value,
        name:document.getElementById('name').value,
        date:document.getElementById('date').value || '',
        subject:document.getElementById('subject').value,
        type:document.getElementById('type').value,
        questions:Number(document.getElementById('questions').value)||'',
        marks:Number(document.getElementById('marks').value)||'',
        time:Number(document.getElementById('time').value)||'',
        obtained:document.getElementById('obtained').value||'',
        remarks:document.getElementById('remarks').value||'',
        status: document.getElementById('obtained').value? 'Completed':'Not Started'
      };
      const idx = tests.findIndex(x=>x.id===id);
      if(idx>=0) tests[idx]=entry; else tests.unshift(entry);
      persist(); renderTable(getFilters()); this.reset(); document.getElementById('uid').value='';
    }

    function generateNewId(platform){
      const pref = platform.includes('Made')? 'ME' : platform.includes('Zeal')? 'ZE' : 'GO';
      // find max existing
      const nums = tests.filter(t=>t.id.startsWith(pref)).map(t=>parseInt(t.id.slice(2))).filter(Boolean);
      const next = nums.length? Math.max(...nums)+1 : 1;
      return pref + String(next).padStart(3,'0');
    }

    document.getElementById('search').addEventListener('input',()=>renderTable(getFilters()));
    document.getElementById('filterPlatform').addEventListener('change',()=>renderTable(getFilters()));
    document.getElementById('filterSubject').addEventListener('change',()=>renderTable(getFilters()));
    document.getElementById('filterStatus').addEventListener('change',()=>renderTable(getFilters()));

    function getFilters(){
      return {platform:document.getElementById('filterPlatform').value, subject:document.getElementById('filterSubject').value, status:document.getElementById('filterStatus').value};
    }

    document.getElementById('pickRandom').onclick = function(){
      const pending = tests.filter(t=>!t.obtained && (!document.getElementById('filterPlatform').value || t.platform===document.getElementById('filterPlatform').value) && (!document.getElementById('filterSubject').value || t.subject===document.getElementById('filterSubject').value));
      if(!pending.length){alert('No pending tests match current filters');return}
      const choice = pending[Math.floor(Math.random()*pending.length)];
      loadIntoForm(choice.id);
      alert('Picked: ' + choice.id + ' â€” ' + choice.name + '\nFill date and press Save when you attempt it.');
    }

    document.getElementById('exportCsv').onclick = function(){
      const rows = tests; const keys = ['id','platform','name','date','subject','type','questions','marks','time','obtained','remarks','status'];
      const csv = [keys.join(',')].concat(rows.map(r=>keys.map(k=>`"${(''+(r[k]||'')).replace(/"/g,'""')}"`).join(','))).join('\n');
      const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='gate_tests_backup.csv'; a.click(); URL.revokeObjectURL(url);
    }

    document.getElementById('importCsv').onclick = function(){
      const inp = document.createElement('input'); inp.type='file'; inp.accept='.csv'; inp.onchange = e=>{
        const f = e.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = ev=>{
          const txt = ev.target.result; parseCsvAndMerge(txt);
        }; reader.readAsText(f);
      }; inp.click();
    }

    function parseCsvAndMerge(txt){
      const lines = txt.split('\n').map(l=>l.trim()).filter(Boolean); const headers = lines.shift().split(',').map(h=>h.replace(/"/g,'').trim());
      const arr = lines.map(l=>{
        const parts = l.match(/(?:\"([^\"]*)\"|([^,]+))/g).map(s=>s.replace(/^\"|\"$/g,''));
        const obj = {}; headers.forEach((h,i)=>obj[h]=parts[i]||''); return obj;
      });
      // Merge by id, otherwise push
      arr.forEach(a=>{ if(a.id){ const idx = tests.findIndex(t=>t.id===a.id); if(idx>=0) tests[idx]=Object.assign(tests[idx],a); else tests.push(a); }});
      persist(); renderTable(getFilters()); alert('Imported '+arr.length+' records');
    }

    document.getElementById('resetData').onclick = function(){ if(confirm('Reset to initial seed data? This will overwrite local edits.')){ localStorage.removeItem(STORAGE_KEY); tests = load(); renderTable(); }}

    // initial render
    renderTable();

    // Brief note: Vercel deployment & updates
    // To deploy: push this single-file repo (index.html) to GitHub and connect to Vercel (Static Site). Any pushes to the repo auto-deploy the new version.
    // For server features (if you want persistent DB), use a small backend (Firebase, Supabase, or Vercel Serverless functions). For now localStorage is used so you can run offline.

  </script>
</body>
</html>
